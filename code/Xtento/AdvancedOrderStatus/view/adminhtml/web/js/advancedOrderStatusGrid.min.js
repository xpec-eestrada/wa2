/**
 * Copyright XTENTO GmbH & Co. KG / http://www.xtento.com
 */

define(['mageUtils', 'jquery', 'uiRegistry'], function (utils, $, registry) {
    'use strict';

    /**
     * Constructor
     * @param {Object} config
     * @constructor
     */
    function advancedOrderStatusGrid(config)
    {
        var grid = registry.get('sales_order_grid.sales_order_grid');
        var dataSource = registry.get('sales_order_grid.sales_order_grid_data_source');

        grid.source.on('reloaded', function () {
            var interval = setInterval(function () {
                if (updateOrderStatusColor(dataSource.data.items) === true) {
                    clearInterval(interval);
                }
            }, 100);
        });
    }

    function updateOrderStatusColor(items)
    {
        var result = false;
        $.each(items, function (rowId, data) {
            if ($('.data-grid.data-grid-draggable tr.data-row:eq(' + rowId + ')').children('td').length > 0) {
                if (data['status_color'] != '') {
                    $('.data-grid.data-grid-draggable tr.data-row:eq(' + rowId + ')').children('td').css('background-color', data['status_color']);
                } else {
                    $('.data-grid.data-grid-draggable tr.data-row:eq(' + rowId + ')').children('td').css('background-color', '');
                }
                result = true;
            } else {
                return false;
            }
        });
        return result;
    }

    /**
     * Custom bulk action callback required to send the additional inputs on the grid to our custom controller
     *
     * @param action
     * @param data
     */
    advancedOrderStatusGrid.prototype.bulkActionCallback = function (action, data) {
        var selections = {};

        selections['selected'] = data['selected'];

        if (!selections['selected'].length) {
            selections['selected'] = false;
        }

        utils.submit({
            url: action.url,
            data: selections
        });
    };

    advancedOrderStatusGrid.prototype.initContainer = function () {
    };

    return advancedOrderStatusGrid;
});